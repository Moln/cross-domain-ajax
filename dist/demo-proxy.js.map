{"version":3,"file":"demo-proxy.js","sources":["webpack:///webpack/universalModuleDefinition?5ca6**","webpack:///webpack/bootstrap afa854f42844b143afa1?dfc8**","webpack:///../index.js","webpack:///../~/@moln/postmessage/postmessage.js?9a1a**","webpack:///../cross-domain-proxy.js?57f0","webpack:///../ajax.js?4072*","webpack:///../url-serialize.js?4add*"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap afa854f42844b143afa1","\nvar cdp = require('./cross-domain-proxy');\n\ncdp.onVerifyOrigin(function (origin) {\n\n    console.log(origin);\n    if (!/localhost:8080$/.test(origin)) {\n        throw new Error('Invalid origin ' + origin);\n    }\n});\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../index.js\n// module id = 0\n// module chunks = 3","(function (root, window, factory) {\r\n    var name = 'pm';\r\n\r\n    if (typeof exports === 'object' && typeof module === 'object')\r\n        module.exports = factory(window);\r\n    else if (typeof define === 'function' && define.amd)\r\n        define([], factory);\r\n    else if (typeof exports === 'object')\r\n        exports[name] = factory(window);\r\n    else\r\n        root[name] = factory(window);\r\n})(this, window, function (window) {\r\n    'use strict';\r\n\r\n    //@see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON\r\n    if (!window.JSON) {\r\n        window.JSON = {\r\n            parse: function (sJSON) {\r\n                return eval(\"(\" + sJSON + \")\");\r\n            },\r\n            stringify: function (str) {\r\n                var strLine = function (str) {\r\n                    return str.replace(/\"/g, \"\\\\$&\").replace(/\\n/g, \"\\\\n\");\r\n                }\r\n                if (str instanceof Object) {\r\n                    var sOutput = \"\";\r\n                    if (str.constructor === Array) {\r\n                        for (var nId = 0; nId < str.length; sOutput += this.stringify(str[nId]) + \",\", nId++) {\r\n                        }\r\n                        return \"[\" + sOutput.substr(0, sOutput.length - 1) + \"]\";\r\n                    }\r\n                    if (str.toString !== Object.prototype.toString) {\r\n                        return \"\\\"\" + strLine(str.toString()) + \"\\\"\";\r\n                    }\r\n                    for (var sProp in str) {\r\n                        sOutput += \"\\\"\" + strLine(sProp) + \"\\\":\" + this.stringify(str[sProp]) + \",\";\r\n                    }\r\n                    return \"{\" + sOutput.substr(0, sOutput.length - 1) + \"}\";\r\n                }\r\n                // console.log(typeof str);\r\n                if (typeof str === \"unknown\") {\r\n                    return \"\\\"[unknown]\\\"\";\r\n                }\r\n                if (typeof str === \"string\") {\r\n                    return \"\\\"\" + strLine(str) + \"\\\"\";\r\n                } else {\r\n                    try {\r\n                        //Fix [object]\r\n                        this.parse(String(str));\r\n\r\n                        return String(str);\r\n                    } catch (e) {\r\n                        if (!str.toString) {\r\n                            return \"\\\"[\"+typeof(str)+\"]\\\"\";\r\n                        } else {\r\n                            return \"\\\"\"+String(str)+\"\\\"\";\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    var extend = function () {\r\n        var a = arguments[0];\r\n        for (var i = 1, len = arguments.length; i < len; i++) {\r\n            var b = arguments[i];\r\n            for (var prop in b) {\r\n                a[prop] = b[prop];\r\n            }\r\n        }\r\n        return a;\r\n    };\r\n\r\n    var handlers = {\r\n        postMessage: function () {\r\n            var self = this,\r\n                dispatch = function (e) {\r\n                    var data = window.JSON.parse(e.data);\r\n\r\n                    if (data.type) {\r\n                        pm.trigger({\r\n                            data: data,\r\n                            origin: e.origin,\r\n                            source: e.source\r\n                        });\r\n                    }\r\n                };\r\n\r\n            this.send = function (target, data, origin) {\r\n                data = window.JSON.stringify(data);\r\n                target.postMessage(data, origin);\r\n            };\r\n\r\n            if (window.addEventListener) {\r\n                window.addEventListener(\"message\", dispatch, false);\r\n            } else if (window.attachEvent) {\r\n                window.attachEvent(\"onmessage\", dispatch);\r\n            }\r\n        },\r\n        opener: function () {\r\n            var self = this;\r\n            var curOrigin = window.location.protocol + '//' + window.location.host;\r\n            var postMessage = [];\r\n            var dispatch = function (params) {\r\n                //real document\r\n                try {\r\n                    if (params.source.window.document && params.source.window.document != document) {\r\n                        params.source.window.document.domain = 'unknownhost';\r\n                        console.warn('Error document, not real.');\r\n                    }\r\n                    return;\r\n                } catch (e) {\r\n                }\r\n\r\n                if (params.origin != '*' && params.origin.replace(/\\//g, '') != curOrigin.replace(/\\//g, '')) {\r\n                    return;\r\n                }\r\n\r\n                pm.trigger({\r\n                    data: window.JSON.parse(params.data),\r\n                    origin: params.source.origin,\r\n                    source: params.source.window\r\n                });\r\n            };\r\n\r\n            var c = setInterval(function () {\r\n                if (window.opener && window.opener.postMessage) {\r\n                    var pmData = window.opener.postMessage;\r\n                    for (var i = 0; i < pmData.length;) {\r\n                        if (pmData[i].target == window) {\r\n                            dispatch(pmData.splice(i, 1)[0]);\r\n                        } else i++;\r\n                    }\r\n                }\r\n            }, 100);\r\n\r\n            this.send = function (target, data, origin) {\r\n                postMessage.push({\r\n                    source: {\r\n                        window: window,\r\n                        origin: curOrigin\r\n                    },\r\n                    data: window.JSON.stringify(data),\r\n                    origin: origin,\r\n                    target: target\r\n                });\r\n                try {\r\n                    target.opener = {postMessage: postMessage};\r\n                } catch (e) {\r\n                    console.warn(\"Target not support \\\"opener.postMessage\\\";\" + e.message);\r\n                }\r\n            };\r\n        },\r\n        hash: function () {\r\n            //todo hash hack\r\n        }\r\n    };\r\n\r\n    var handler = new handlers[window.postMessage ? 'postMessage' : 'opener']();\r\n\r\n    var events = {}, eventTick = 0;\r\n    var pm = {\r\n        handler: handler,\r\n        defaults: {\r\n            target: null, /* target window (required) */\r\n            type: null, /* message type (required) */\r\n            data: null, /* message data (required) */\r\n            callback: null, /* call callback (optional) */\r\n            complete: null, /* complete callback (optional) */\r\n            origin: \"*\"    /* postmessage origin (optional) */\r\n        },\r\n        send: function (argType, argTarget, argData, argOptions) {\r\n\r\n            var options = {};\r\n            if (typeof argType == 'object') {\r\n                options = argType;\r\n            } else {\r\n                options = extend({\r\n                    type: argType,\r\n                    target: argTarget,\r\n                    data: argData\r\n                }, argOptions);\r\n            }\r\n            var o = extend({}, pm.defaults, options),\r\n                target = o.target, id = ++eventTick;\r\n            if (!o.target || !o.type) {\r\n                throw new Error(\"Arguments [target,type] required\");\r\n            }\r\n\r\n            o.callback && this.bind('postMessage.callback.' + id, function (e) {\r\n                if (e.source == o.target) {\r\n                    o.callback.apply(e, e.data);\r\n                }\r\n            }, true);\r\n            o.complete && this.bind('postMessage.complete.' + id, function (e) {\r\n                if (e.source == o.target) {\r\n                    o.complete.call(e, e.data);\r\n                }\r\n            }, true);\r\n\r\n            handler.send(target, {\r\n                data: o.data,\r\n                type: o.type,\r\n                callback: o.callback ? true : false,\r\n                complete: o.complete ? true : false,\r\n                id: id\r\n            }, o.origin || '*');\r\n            return id;\r\n        },\r\n\r\n        bind: function (type, fn, once) {\r\n            events[type] = events[type] || [];\r\n            events[type].push([function (msg) {\r\n                var data = msg.data,\r\n                    callback = function () {\r\n                        msg.callback && handler.send(msg.source, {\r\n                            data: Array.prototype.slice.call(arguments),\r\n                            type: 'postMessage.callback.' + msg.id\r\n                        }, msg.origin);\r\n                    },\r\n                    rs = fn.call(this, {\r\n                        data: data,\r\n                        source: msg.source,\r\n                        origin: msg.origin,\r\n                        callback: callback\r\n                    });\r\n\r\n                msg.complete && handler.send(msg.source, {\r\n                    data: rs,\r\n                    type: 'postMessage.complete.' + msg.id\r\n                }, msg.origin);\r\n            }, once]);\r\n        },\r\n        one: function (type, fn) {\r\n            this.bind(type, fn, true);\r\n        },\r\n        trigger: function (e) {\r\n            e.data.origin = e.origin;\r\n            e.data.source = e.source;\r\n            if (events[e.data.type]) {\r\n                for (var i = 0; i < events[e.data.type].length; i++) {\r\n                    events[e.data.type][i][0](e.data);\r\n                    if (events[e.data.type][i][1]) {\r\n                        events[e.data.type].splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return pm;\r\n});\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../~/@moln/postmessage/postmessage.js\n// module id = 2\n// module chunks = 0 1 2 3","var pm = require('@moln/postmessage');\nvar ajax = require('./ajax');\n\nvar extend = function () {\n    var options, name, src, copy,\n        target = arguments[0] || {},\n        i = 1,\n        length = arguments.length;\n\n\n    if (typeof target !== \"object\") {\n        target = {};\n    }\n\n    for (; i < length; i++) {\n        if ((options = arguments[i]) != null) {\n            // Extend the base object\n            for (name in options) {\n                src = target[name];\n                copy = options[name];\n\n                if (target === copy) {\n                    continue;\n                }\n\n                target[name] = copy;\n            }\n        }\n    }\n\n    return target;\n};\n\nvar serializeScale = function (obj) {\n    var result = {};\n    for (var i in obj) {\n        if (typeof obj[i] != 'function') {\n            result[i] = obj[i];\n        }\n    }\n\n    return result;\n};\n\nvar verifyOrigin = function () {};\n\nvar onVerifyOrigin = function (cb) {\n    verifyOrigin = cb;\n};\n\npm.bind('cross-ajax', function (params) {\n    verifyOrigin(params.origin);\n    var data = params.data;\n\n    ajax(extend(data, {\n        headers: {\n            'X-Referer': document.referrer\n        },\n        success: function (data, request) {\n            pm.send({\n                target: window.parent,\n                type: 'cross-ajax.success',\n                data: data\n            });\n        },\n        error: function (request) {\n            pm.send({\n                target: window.parent,\n                type: 'cross-ajax.error',\n                data: request\n            });\n        },\n        complete: function (request) {\n            var result = request.status >= 200 && request.status < 300 ? 'success' : 'error';\n            params.callback(result, serializeScale(request));\n            pm.send({\n                target: window.parent,\n                type: 'cross-ajax.complete',\n                data: request\n            });\n        }\n    }))\n});\n\nmodule.exports = {\n    onVerifyOrigin: onVerifyOrigin\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../cross-domain-proxy.js\n// module id = 3\n// module chunks = 1 3","var urlSerialize = require('./url-serialize');\n\nmodule.exports = window.ajax = function (params) {\n    var defaults = {\n        url: false,\n        type: \"GET\",\n        data: \"\",\n        contentType: \"application/x-www-form-urlencoded\",\n        async: true,\n        success: function (data) {\n        },\n        error: function (request) {\n        },\n        charset: \"UTF-8\"\n    };\n\n    for (var i in defaults) {\n        if (params[i] === undefined) params[i] = defaults[i];\n    }\n    params.type = params.type.toUpperCase();\n\n    if (!params.url) alert('Url not empty!');\n    var request;\n    var httpRequest = function () {\n        if (typeof XMLHttpRequest != \"undefined\") {\n            request = new XMLHttpRequest();\n        } else if (window.ActiveXObject) {\n            var aVersions = [\"Msxml2.XMLHttp.5.0\", \"Msxml2.XMLHttp.4.0\", \"Msxml2.XMLHttp.3.0\", \"Msxml2.XMLHttp\", \"Microsoft.XMLHttp\"];\n            for (var i = 0; i < aVersions.length; i++) {\n                try {\n                    request = new ActiveXObject(aVersions[i]);\n                    break;\n                } catch (e) {\n                }\n            }\n        }\n        if (request) {\n            initReq();\n        } else {\n            alert(\"Your browser does not permit the use of all \" +\n                \"of this application's features!\");\n        }\n    };\n\n    var initReq = function () {\n        request.open(params.type, params.url, params.async);\n        /* Set the Content-Type header for a POST request */\n        if (params.type !== 'GET') {\n            request.setRequestHeader(\"Content-Type\", params.contentType + \"; charset=\" + params.charset);\n        }\n\n        request.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n        if (params.headers) {\n            for (var i in params.headers) {\n                request.setRequestHeader(i, params.headers[i]);\n            }\n        }\n        try {\n            request.send(urlSerialize(params.data));\n        } catch (e) {\n            return false;\n        }\n        request.onreadystatechange = handleResponse;\n        return true;\n    };\n\n    var handleResponse = function () {\n        if (request.readyState == 4) {\n\n            var cType = request.getResponseHeader('Content-Type');\n            if (cType && /application\\/([\\w\\b]*)json([\\w\\b]*)/.test(cType)) {\n                //application/json; charset=utf-8\n                //application/hal+json\n                request.responseJSON = window.JSON.parse(request.responseText);\n            }\n\n            if (request.status >= 200 && request.status < 300) {\n                params.success(request.responseJSON !== undefined ? request.responseJSON : request.responseText, request);\n            } else {\n                params.error(request);\n            }\n\n            params.complete && params.complete(request);\n        }\n    };\n    httpRequest();\n\n    if (!params.async) {\n        if (request.status >= 200 && request < 300) params.success(request.responseJSON !== undefined ? request.responseJSON : request.responseText);\n        else params.error(request);\n    }\n\n    return request;\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../ajax.js\n// module id = 4\n// module chunks = 1 2 3","module.exports = function (params) {\n    var query = '';\n    if (typeof(params) == \"string\") {\n        query = params;\n    } else if (params instanceof window.Array) {\n        for (var i = 0; i < params.length; i++) {\n            query += '&' + encodeURIComponent(params[i].name) + '=' + encodeURIComponent(params[i].value)\n        }\n        query = query.substr(1);\n    } else if (typeof(params) == \"object\") {\n        for (var i in params) {\n            query += '&' + encodeURIComponent(i)+'='+encodeURIComponent(params[i]) ;\n        }\n        query = query.substr(1);\n    }\n    return query;\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ../url-serialize.js\n// module id = 5\n// module chunks = 1 2 3"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACtCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC5PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;","sourceRoot":""}